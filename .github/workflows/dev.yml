name: dev
on: [ push, pull_request ]
jobs:
  build:
    uses: ./.github/workflows/build.yml
    with:
      version: today
  prepare_tests:
    uses: ./.github/workflows/prepare_tests.yml
    needs: build
  gcp_tests:
    needs: prepare_tests
    permissions:
      id-token: write
    uses: ./.github/workflows/gcp_tests.yml
    secrets:
      gcp_identity_provider: ${{ secrets.GCP_WORKLOAD_IDENTITY_PROVIDER }}
      gcp_service_account: ${{ secrets.GCP_SERVICE_ACCOUNT }}
      gcp_project: ${{ secrets.GCP_PROJECT }}
      gcp_region: ${{ secrets.GCP_REGION }}
      gcp_zone: ${{ secrets.GCP_ZONE }}
