name: nightly
on:
  schedule:
    - cron: '0 6 * * *'
jobs:
  build:
    uses: ./.github/workflows/build.yml
    with:
      version: now
  platform_test:
    uses: ./.github/workflows/platform_test_multiplexer.yml
    needs: build
  upload_to_s3:
    name: upload to S3
    needs: platform_tests
    permissions:
      id-token: write
    uses: ./.github/workflows/upload_to_s3.yml
    secrets:
      bucket: ${{ secrets.AWS_S3_BUCKET }}
      region: ${{ secrets.AWS_REGION }}
      role: ${{ secrets.AWS_IAM_ROLE }}
      session: ${{ secrets.AWS_OIDC_SESSION }}
