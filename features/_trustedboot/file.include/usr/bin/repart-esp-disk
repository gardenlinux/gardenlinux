#!/usr/bin/env bash

set -eufo pipefail

efi_part_dev="$(realpath "$1")"
efi_part_name="$(basename "$efi_part_dev")"

disk_name="$(basename "$(realpath "/sys/class/block/$efi_part_name/..")")"
disk_dev="/dev/$disk_name"

echo | sfdisk "$disk_dev"
systemd-repart --dry-run=no "$disk_dev"
udevadm settle
