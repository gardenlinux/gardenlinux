cfgs:
  default:
    branches: ['main']
    inherit:
      gardenlinux:
        base_definition:
          repo:
            name: GARDENLINUX
            cfg_name: github_com
        jobs:
          trigger_release_from_current_head:
            repo:
              trigger: false
            steps:
              render_pipelines_and_trigger_job:
                execute: '../ci/render_pipelines_and_trigger_job'
                vars:
                  PROMOTE_TARGET: "'release'"
                  PUBLISHING_ACTIONS: "'manifests,images,release,component_descriptor'"
          pull_requests:
            steps:
              render_pipelines_and_trigger_job:
                execute:
                - '../ci/render_pipelines_and_trigger_job'
                - --image-build
                - --wait
                vars:
                  PROMOTE_TARGET: "'snapshot'"
                  PUBLISHING_ACTIONS: "'manifests'"
            traits:
              pull-request: ~
          mr_proper:
            traits:
              cronjob:
                interval: '24h'
            steps:
              clean_build_result_repositories: ~

  release_branches:
    branches: ['rel-.*']
    inherit:
      gardenlinux:
        base_definition:
          repo:
            name: GARDENLINUX
            cfg_name: github_com
        jobs:
          trigger_release:
            repo:
              trigger: false
            steps:
              render_pipelines_and_trigger_job:
                execute:
                  - '../ci/render_pipelines_and_trigger_job'
                  - '--image-build'
                vars:
                  PROMOTE_TARGET: "'release'"
                  PUBLISHING_ACTIONS: "'manifests,images,release'"

  dev_branches:
    branches: ['dev-.*']
    inherit:
      gardenlinux: ~

  integration_test_branches:
    branches: ['integrity']
    inherit:
      gardenlinux:
        jobs:
          run_integration_tests:
            repo:
              trigger: true
            steps:
              run_integration_tests: ~
        base_definition:
          repo:
            name: GARDENLINUX
            cfg_name: github_com
